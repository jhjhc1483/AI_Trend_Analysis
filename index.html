<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ê³µì§€ëŠ¥ ë™í–¥ ë¶„ì„ ì‚¬ì´íŠ¸ | AI Trend Analyzer</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f9; }
        /* ìƒˆë¡œ ì¶”ê°€: ê³ ì • í—¤ë” ìŠ¤íƒ€ì¼ */
        
        #header-fixed {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #471c87; /* ìœ¡êµ°ì„ ìƒì§•í•˜ëŠ” ì§„í•œ ìƒ‰ìƒ : #2A5034*/
            color: white;
            text-align: center;
            padding: 15px 0;
            font-size: 1.8em;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
        }

        /* ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼: ê³ ì • í—¤ë”ì˜ ë†’ì´ë§Œí¼ ìƒë‹¨ì— ì—¬ë°±ì„ ì¤ë‹ˆë‹¤. */
        .container { 
            display: flex; 
            max-width: 1400px; 
            margin: 20px auto; 
            background-color: #fff; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            border-radius: 8px; 
            overflow: hidden; 
            /* ê³ ì • í—¤ë” ë†’ì´(15px*2+padding)ì— ë§ê²Œ ìƒë‹¨ ë§ˆì§„ì„ ì¡°ì •í•©ë‹ˆë‹¤. */
            margin-top: 80px; /* ëŒ€ëµì ì¸ ê³ ì • í—¤ë” ë†’ì´ + 20px ë§ˆì§„ */
            min-height: calc(100vh - 120px); /* í—¤ë”, í‘¸í„° ê³ ë ¤í•˜ì—¬ ë†’ì´ ì¡°ì • */
        }
        
        /* ì‚¬ì´ë“œë°” (ë©”ë‰´) ìŠ¤íƒ€ì¼ */
        .sidebar { 
            width: 250px; 
            background-color: #2c3e50; 
            color: white; 
            padding: 20px 0; 
            height: auto; 
            overflow-y: auto; 
            flex-shrink: 0;
            /* ê³ ì • í—¤ë” ë•Œë¬¸ì— ìŠ¤í¬ë¡¤ì´ sidebar ì „ì²´ì— ì ìš©ë˜ë„ë¡ relative position ìœ ì§€ */
        }
        .logo { text-align: center; padding-bottom: 20px; font-size: 1.5em; font-weight: bold; border-bottom: 1px solid #34495e; margin-bottom: 20px; }
        .menu-group { margin-bottom: 20px; padding: 0 20px; }
        .menu-title { font-size: 1.1em; font-weight: bold; color: #ecf0f1; margin-bottom: 10px; border-bottom: 1px solid #4a637a; padding-bottom: 5px; }
        .tab-button { display: block; padding: 10px 0; color: #bdc3c7; text-decoration: none; transition: background-color 0.3s, color 0.3s; border-radius: 4px; padding-left: 10px; }
        .tab-button:hover { background-color: #34495e; color: #fff; }
        .tab-button.active { background-color: #3498db; color: #fff; font-weight: bold; }

        /* ë©”ì¸ ì½˜í…ì¸  ìŠ¤íƒ€ì¼ */
        .content { flex-grow: 1; padding: 30px; }
        h1 { color: #2c3e50; margin-top: 0; }
        
        /* ì»¨íŠ¸ë¡¤ ì˜ì—­ (ê²€ìƒ‰, ì •ë ¬) */
        .controls-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background-color: #ecf0f1; border-radius: 6px; }
        .search-controls input, .sort-controls select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        .sort-controls label { margin-right: 10px; font-weight: bold; color: #2c3e50; }

        /* ê¸°ì‚¬ ëª©ë¡/ê°„í–‰ë¬¼ ëª©ë¡ ìŠ¤íƒ€ì¼ (í†µì¼) */
        .article-list { list-style: none; padding: 0; }
        .article-item { background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 10px; padding: 15px; display: flex; justify-content: space-between; align-items: center; transition: box-shadow 0.2s; position: relative; }
        .article-item:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .article-title-group { flex-grow: 1; margin-right: 20px; }
        .article-title { font-size: 1.1em; color: #3498db; text-decoration: none; font-weight: bold; cursor: pointer; }
        .article-meta { color: #7f8c8d; font-size: 0.9em; margin-top: 5px; }
        .article-meta span { margin-right: 15px; }
        .article-date { flex-shrink: 0; font-weight: bold; color: #2c3e50; font-size: 1em; }
        
        /* ì¦ê²¨ì°¾ê¸° ë²„íŠ¼ */
        .favorite-btn { background: none; border: none; font-size: 1.5em; cursor: pointer; padding: 0 5px; color: #ccc; transition: color 0.2s; }
        .favorite-btn.is-favorite { color: #f39c12; }
        .favorite-btn:hover { color: #e67e22; }

        /* ë°ì´í„° ì—†ìŒ ë©”ì‹œì§€ */
        #no-data { text-align: center; color: #e74c3c; padding: 40px; border: 1px dashed #e74c3c; border-radius: 6px; margin-top: 20px; display: none; }
        
        /* ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ */
        #dashboard-view { padding: 20px; background-color: #ecf0f1; border-radius: 8px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background-color: #fff; padding: 20px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center; }
        .stat-card h3 { color: #34495e; margin-top: 0; font-size: 1.1em; }
        .stat-card p { font-size: 2.5em; font-weight: bold; color: #3498db; margin: 5px 0 0 0; }
        .trend-section h2 { border-bottom: 2px solid #bdc3c7; padding-bottom: 10px; color: #2c3e50; }
        .latest-list { list-style: none; padding: 0; }
        .latest-item { background-color: #f9f9f9; padding: 10px; margin-bottom: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .latest-item a { color: #2c3e50; text-decoration: none; font-weight: bold; }
        .latest-item a:hover { text-decoration: underline; }
        .latest-item span { font-size: 0.9em; color: #7f8c8d; }

        /* ìƒˆë¡œ ì¶”ê°€: ì¹´í”¼ë¼ì´íŠ¸ ìŠ¤íƒ€ì¼ */
        #footer-copyright {
            text-align: center;
            padding: 15px 0;
            font-size: 0.9em;
            color: #7f8c8d;
            background-color: #ecf0f1;
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <div id="header-fixed">
        ì¸ê³µì§€ëŠ¥ ì¼ì¼ë™í–¥ ë¶„ì„
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="logo">AI ë™í–¥ë¶„ì„</div>
            <nav id="main-nav">
                <div class="menu-group">
                    <a href="#" class="tab-button active" data-source="HOME">ğŸ  ëŒ€ì‹œë³´ë“œ</a>
                </div>

                <div class="menu-group">
                    <div class="menu-title">ê¸°ì‚¬ (NEWS)</div>
                    <a href="#" class="tab-button" data-source="ARTICLE_ALL">ğŸ“° ì „ì²´ë³´ê¸°</a>
                    <a href="#" class="tab-button" data-source="ARTICLE_FAV">â­ï¸ ì¦ê²¨ì°¾ê¸°</a>
                    <a href="#" class="tab-button" data-source="AITIMES">AI Times</a>
                    <a href="#" class="tab-button" data-source="ETNEWS">ì „ìì‹ ë¬¸</a>
                    <a href="#" class="tab-button" data-source="MND">êµ­ë°©ë‰´ìŠ¤</a>
                </div>
                <div class="menu-group">
                    <div class="menu-title">ê°„í–‰ë¬¼ (PUBLICATION)</div>
                    <a href="#" class="tab-button" data-source="PUBLICATION_ALL">ğŸ“š ì „ì²´ë³´ê¸°</a>
                    <a href="#" class="tab-button" data-source="PUBLICATION_FAV">â­ï¸ ì¦ê²¨ì°¾ê¸°</a>
                    <a href="#" class="tab-button" data-source="NIA">NIA</a>
                    <a href="#" class="tab-button" data-source="IITP">IITP</a>
                    <a href="#" class="tab-button" data-source="STEPI">STEPI</a>
                    <a href="#" class="tab-button" data-source="NIPA">NIPA</a>
                </div>
            </nav>
        </div>

        <div class="content">
            <h1 id="main-content-title">í™ˆ (ëŒ€ì‹œë³´ë“œ)</h1>

            <div id="dashboard-view">
                <h2>ğŸ“Š ìš”ì•½ ì •ë³´</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>ì´ ê¸°ì‚¬ ìˆ˜</h3>
                        <p id="stat-articles">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>ì´ ê°„í–‰ë¬¼ ìˆ˜</h3>
                        <p id="stat-publications">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>ì¦ê²¨ì°¾ëŠ” ê¸°ì‚¬ ìˆ˜</h3>
                        <p id="stat-fav-articles">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>ì¦ê²¨ì°¾ëŠ” ê°„í–‰ë¬¼ ìˆ˜</h3>
                        <p id="stat-fav-publications">0</p>
                    </div>
                </div>

                <div class="trend-section">
                    <h2>âœ¨ ìµœì‹  ê¸°ì‚¬ 5ê°œ</h2>
                    <ul class="latest-list" id="latest-articles">
                        </ul>
                </div>

                <div class="trend-section">
                    <h2>âœ¨ ìµœì‹  ê°„í–‰ë¬¼ 5ê°œ</h2>
                    <ul class="latest-list" id="latest-publications">
                        </ul>
                </div>
            </div>

            <div class="controls-row" id="article-controls" style="display: none;">
                <div class="search-controls">
                    <input type="text" id="search-term-article" placeholder="ê¸°ì‚¬ ê²€ìƒ‰ (ì œëª©, ì‚¬ì´íŠ¸)" onkeyup="debounceSearchArticles()">
                </div>
                <div class="sort-controls">
                    <label for="sort-by-article">ì •ë ¬ ê¸°ì¤€:</label>
                    <select id="sort-by-article" onchange="renderCurrentView()">
                        <option value="date_desc">ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ìˆœ)</option>
                        <option value="date_asc">ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ (ì˜¤ë˜ëœìˆœ)</option>
                        <option value="title_asc">ì œëª© ì˜¤ë¦„ì°¨ìˆœ</option>
                        <option value="site_asc">ì‚¬ì´íŠ¸ ì˜¤ë¦„ì°¨ìˆœ</option>
                    </select>
                </div>
            </div>

            <div class="controls-row" id="publication-controls" style="display: none;">
                <div class="search-controls">
                    <input type="text" id="search-term-publication" placeholder="ê°„í–‰ë¬¼ ê²€ìƒ‰ (ì œëª©, ë¶„ë¥˜)" onkeyup="debounceSearchPublications()">
                </div>
                <div class="sort-controls">
                    <label for="sort-by-publication">ì •ë ¬ ê¸°ì¤€:</label>
                    <select id="sort-by-publication" onchange="renderCurrentView()">
                        <option value="date_desc">ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ìˆœ)</option>
                        <option value="date_asc">ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ (ì˜¤ë˜ëœìˆœ)</option>
                        <option value="title_asc">ì œëª© ì˜¤ë¦„ì°¨ìˆœ</option>
                        <option value="category_asc">ë¶„ë¥˜ ì˜¤ë¦„ì°¨ìˆœ</option>
                    </select>
                </div>
            </div>
            
            <div id="list-view" style="display: none;">
                <ul class="article-list" id="data-list-container">
                    </ul>
                <div id="no-data">ë°ì´í„° ë¡œë“œ ì¤‘...</div>
            </div>
            
        </div>
    </div>
    
    <div id="footer-copyright">
        &copy; maj.cjh. All rights reserved.
    </div>

    <script>
        // -----------------------------------------------------
        // 1. ì „ì—­ ë³€ìˆ˜ ì„¤ì • ë° ë°ì´í„° ë¡œë“œ íŒŒì¼ ì •ì˜
        // -----------------------------------------------------
        let articleData = []; // ê¸°ì‚¬ ë°ì´í„° (AI Times, ETNEWS, MND)
        let publicationData = []; // ê°„í–‰ë¬¼ ë°ì´í„° (NIA, IITP)
        let allDataLoaded = false;
        let debounceTimeout;
        let currentView = 'HOME'; // í˜„ì¬ í™œì„±í™”ëœ ë·° (HOME, ARTICLE_ALL, AITIMES, PUBLICATION_ALL ë“±)

        // ì¦ê²¨ì°¾ê¸° ìƒíƒœë¥¼ ì €ì¥í•˜ëŠ” Set (key: link)
        let favoriteArticles = new Set();
        let favoritePublications = new Set();
        
        const FILES_TO_LOAD = [
            { url: 'codes/aitimes.json', site: 'AITIMES', isArticle: true, displayName: 'AI Times' },
            { url: 'codes/etnews.json', site: 'ETNEWS', isArticle: true, displayName: 'ì „ìì‹ ë¬¸' },
            { url: 'codes/mnd.json', site: 'MND', isArticle: true, displayName: 'êµ­ë°©ë‰´ìŠ¤' },
            { url: 'codes/iitp.json', site: 'IITP', isArticle: false, displayName: 'IITP' },
            { url: 'codes/nia.json', site: 'NIA', isArticle: false, displayName: 'NIA' },
            { url: 'codes/STEPI.json', site: 'STEPI', isArticle: false, displayName: 'STEPI' },
            { url: 'codes/NIPA.json', site: 'NIPA', isArticle: false, displayName: 'NIPA' }
        ];

        // -----------------------------------------------------
        // 2. ë°ì´í„° ë¡œë”© í•¨ìˆ˜
        // -----------------------------------------------------
        function loadData() {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì¦ê²¨ì°¾ê¸° ë¡œë“œ
            const favArticles = localStorage.getItem('favoriteArticles');
            const favPublications = localStorage.getItem('favoritePublications');
            if (favArticles) favoriteArticles = new Set(JSON.parse(favArticles));
            if (favPublications) favoritePublications = new Set(JSON.parse(favPublications));
        
            // ìºì‹œ ë²„ìŠ¤íŒ…ì„ ìœ„í•œ í˜„ì¬ ì‹œê°„ (ë°€ë¦¬ì´ˆ) - ë§¤ë²ˆ ê³ ìœ í•œ ê°’ ìƒì„±
            const cacheBuster = Date.now();
        
            const promises = FILES_TO_LOAD.map(file => {
                // URLì— ê³ ìœ í•œ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì¶”ê°€
                const urlWithCacheBuster = `${file.url}?_=${cacheBuster}`;
        
                return fetch(urlWithCacheBuster) // ìˆ˜ì •ëœ URL ì‚¬ìš©
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Failed to load ${file.url}: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // ê° ë°ì´í„° í•­ëª©ì— site, isArticle, link í•„ë“œ ì¶”ê°€
                        return data.map(item => ({
                            ...item,
                            site: file.site,
                            isArticle: file.isArticle,
                            displayName: file.displayName,
                            // ê¸°ì‚¬ëª…/ì œëª©, ë§í¬ í†µì¼
                            title: item.ê¸°ì‚¬ëª… || item.ì œëª© || 'ì œëª© ì—†ìŒ',
                            link: item.ë§í¬ || item.link || '#',
                            category: item.ë¶„ë¥˜ || item.category || '',
                        }));
                    })
                    .catch(error => {
                        console.error(`Error loading ${file.url}:`, error);
                        return []; // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¹ˆ ë°°ì—´ ë°˜í™˜
                    });
            });
        
            Promise.all(promises)
                .then(results => {
                    results.forEach(siteData => {
                        if (siteData.length > 0) {
                            if (siteData[0].isArticle) {
                                articleData = articleData.concat(siteData);
                            } else {
                                publicationData = publicationData.concat(siteData);
                            }
                        }
                    });
        
                    allDataLoaded = true;
                    console.log(`ì´ ${articleData.length}ê°œì˜ ê¸°ì‚¬ ë°ì´í„°ì™€ ${publicationData.length}ê°œì˜ ê°„í–‰ë¬¼ ë°ì´í„° ë¡œë“œ ì™„ë£Œ.`);
        
                    // ì´ˆê¸° íƒ­ ë Œë”ë§ (HOME)
                    showTab('HOME');
                })
                .catch(error => {
                    console.error("Critical error in Promise.all:", error);
                    document.getElementById('no-data').textContent = "ë°ì´í„° ë¡œë“œ ì¤‘ ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ ë°œìƒ.";
                });
        }

        // -----------------------------------------------------
        // 3. ì •ë ¬ í•¨ìˆ˜
        // -----------------------------------------------------
        function sortData(data, sortBy) {
            // ë°ì´í„° ë³µì‚¬ë³¸ì„ ì •ë ¬
            const sortedData = [...data];

            sortedData.sort((a, b) => {
                // ë…„ì›”ì¼ì‹œë¶„ ë°ì´í„°ë¥¼ í•©ì³ ë¹„êµí•©ë‹ˆë‹¤. (ì˜ˆ: 202512101030)
                const getDateString = (item) => `${item.ë…„ || '0000'}${item.ì›” || '00'}${item.ì¼ || '00'}${item.ì‹œ || '00'}${item.ë¶„ || '00'}`;
                const dateA = getDateString(a);
                const dateB = getDateString(b);
                const titleA = a.title;
                const titleB = b.title;
                const siteA = a.site;
                const siteB = b.site;
                const categoryA = a.category;
                const categoryB = b.category;

                switch (sortBy) {
                    case 'date_asc':
                        return dateA.localeCompare(dateB);
                    case 'date_desc':
                        return dateB.localeCompare(dateA);
                    case 'title_asc':
                        return titleA.localeCompare(titleB);
                    case 'site_asc':
                        if (siteA !== siteB) return siteA.localeCompare(siteB);
                        return dateB.localeCompare(dateA); // ì‚¬ì´íŠ¸ ê°™ìœ¼ë©´ ìµœì‹ ìˆœ
                    case 'category_asc': 
                        if (categoryA !== categoryB) return categoryA.localeCompare(categoryB);
                        return dateB.localeCompare(dateA); // ì¹´í…Œê³ ë¦¬ ê°™ìœ¼ë©´ ìµœì‹ ìˆœ
                    default:
                        return 0;
                }
            });
            return sortedData;
        }


        // -----------------------------------------------------
        // 4. íƒ­ ì „í™˜ ë° ë Œë”ë§ í•¨ìˆ˜
        // -----------------------------------------------------
        function showTab(sourceName) {
            currentView = sourceName;
            
            // íƒ­ ë²„íŠ¼ì˜ í™œì„± ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeTab = document.querySelector(`.tab-button[data-source="${sourceName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }

            // ë·° ì „í™˜
            const isHome = sourceName === 'HOME';
            const isArticleView = sourceName.includes('ARTICLE') || ['AITIMES', 'ETNEWS', 'MND'].includes(sourceName);
            const isPublicationView = sourceName.includes('PUBLICATION') || ['NIA', 'IITP','STEPI', 'NIPA'].includes(sourceName);

            document.getElementById('dashboard-view').style.display = isHome ? 'block' : 'none';
            document.getElementById('list-view').style.display = isHome ? 'none' : 'block';

            document.getElementById('article-controls').style.display = isArticleView ? 'flex' : 'none';
            document.getElementById('publication-controls').style.display = isPublicationView ? 'flex' : 'none';
            
            // ì œëª© ì—…ë°ì´íŠ¸
            document.getElementById('main-content-title').textContent = activeTab ? activeTab.textContent.replace(/^(ğŸ |ğŸ“°|â­ï¸|ğŸ“š) /, '') : 'AI ë™í–¥ ë¶„ì„';

            // ë Œë”ë§ í•¨ìˆ˜ í˜¸ì¶œ
            if (isHome) {
                renderDashboard();
            } else {
                renderList(sourceName);
            }
        }
        
        function renderCurrentView() {
            showTab(currentView);
        }

        // -----------------------------------------------------
        // 5. ëŒ€ì‹œë³´ë“œ ë Œë”ë§ í•¨ìˆ˜
        // -----------------------------------------------------
        function renderDashboard() {
            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('stat-articles').textContent = articleData.length;
            document.getElementById('stat-publications').textContent = publicationData.length;
            document.getElementById('stat-fav-articles').textContent = favoriteArticles.size;
            document.getElementById('stat-fav-publications').textContent = favoritePublications.size;

            // ìµœì‹  ê¸°ì‚¬ 5ê°œ (ì „ì²´ ê¸°ì‚¬ì—ì„œ ìµœì‹ ìˆœ ì •ë ¬ í›„ 5ê°œ)
            const sortedArticles = sortData(articleData, 'date_desc');
            const latestArticles = sortedArticles.slice(0, 5);
            document.getElementById('latest-articles').innerHTML = latestArticles.map(item => `
                <li class="latest-item">
                    <a href="#" onclick="openPopup('${item.link}', '${item.title}'); return false;">${item.title}</a>
                    <span>${item.displayName} | ${item.ë…„}.${item.ì›”}.${item.ì¼}</span>
                </li>
            `).join('');

            // ìµœì‹  ê°„í–‰ë¬¼ 5ê°œ
            const sortedPublications = sortData(publicationData, 'date_desc');
            const latestPublications = sortedPublications.slice(0, 5);
            document.getElementById('latest-publications').innerHTML = latestPublications.map(item => `
                <li class="latest-item">
                    <a href="#" onclick="openPopup('${item.link}', '${item.title}'); return false;">${item.title}</a>
                    <span>${item.displayName} | ${item.ë…„}.${item.ì›”}.${item.ì¼}</span>
                </li>
            `).join('');
        }

        // -----------------------------------------------------
        // 6. ëª©ë¡ ë Œë”ë§ í•¨ìˆ˜ (ê¸°ì‚¬ ë° ê°„í–‰ë¬¼ ê³µí†µ)
        // -----------------------------------------------------
        function renderList(sourceName) {
            let data = [];
            let sortBy, searchTerm, dataLabel;

            const isArticle = sourceName.includes('ARTICLE') || ['AITIMES', 'ETNEWS', 'MND'].includes(sourceName);
            const isAll = sourceName.includes('_ALL');
            const isFav = sourceName.includes('_FAV');
            
            if (isArticle) {
                sortBy = document.getElementById('sort-by-article').value;
                searchTerm = document.getElementById('search-term-article').value.toLowerCase();
                dataLabel = 'ê¸°ì‚¬';
                
                if (isFav) {
                    // ì¦ê²¨ì°¾ê¸° ê¸°ì‚¬ í•„í„°ë§
                    data = articleData.filter(a => favoriteArticles.has(a.link));
                } else if (isAll) {
                    // ì „ì²´ ê¸°ì‚¬
                    data = articleData;
                } else {
                    // ê°œë³„ ê¸°ì‚¬ ì†ŒìŠ¤
                    data = articleData.filter(a => a.site === sourceName);
                }
            } else { // Publication
                sortBy = document.getElementById('sort-by-publication').value;
                searchTerm = document.getElementById('search-term-publication').value.toLowerCase();
                dataLabel = 'ê°„í–‰ë¬¼';

                if (isFav) {
                    // ì¦ê²¨ì°¾ê¸° ê°„í–‰ë¬¼ í•„í„°ë§
                    data = publicationData.filter(p => favoritePublications.has(p.link));
                } else if (isAll) {
                    // ì „ì²´ ê°„í–‰ë¬¼
                    data = publicationData;
                } else {
                    // ê°œë³„ ê°„í–‰ë¬¼ ì†ŒìŠ¤
                    data = publicationData.filter(p => p.site === sourceName);
                }
            }

            // ê²€ìƒ‰ í•„í„°ë§
            if (searchTerm) {
                data = data.filter(item => 
                    item.title.toLowerCase().includes(searchTerm) || 
                    item.category.toLowerCase().includes(searchTerm) ||
                    item.site.toLowerCase().includes(searchTerm)
                );
            }

            // ì •ë ¬
            const filteredAndSortedData = sortData(data, sortBy);

            const listContainer = document.getElementById('data-list-container');
            const noDataMsg = document.getElementById('no-data');

            if (filteredAndSortedData.length === 0) {
                listContainer.innerHTML = '';
                noDataMsg.style.display = 'block';
                noDataMsg.textContent = searchTerm 
                    ? `ê²€ìƒ‰ì–´ "${searchTerm}"ì— í•´ë‹¹í•˜ëŠ” ${dataLabel}ê°€(ì´) ì—†ìŠµë‹ˆë‹¤.` 
                    : `${document.querySelector(`.tab-button[data-source="${sourceName}"]`).textContent.replace(/^(ğŸ“°|â­ï¸|ğŸ“š) /, '')} ${dataLabel} ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`;
            } else {
                listContainer.innerHTML = filteredAndSortedData.map(item => createListItem(item)).join('');
                noDataMsg.style.display = 'none';
            }
        }
        
        function createListItem(item) {
            // ë‚ ì§œ í˜•ì‹
            const timeInfo = (item.ì‹œ && item.ë¶„) 
                ? `${item.ì‹œ.padStart(2, '0')}:${item.ë¶„.padStart(2, '0')}` 
                : '';
            const fullDate = `${item.ë…„}.${item.ì›”}.${item.ì¼} ${timeInfo}`;

            // ì¦ê²¨ì°¾ê¸° ìƒíƒœ í™•ì¸
            const isFavorite = item.isArticle 
                ? favoriteArticles.has(item.link) 
                : favoritePublications.has(item.link);
            const favIcon = isFavorite ? 'â˜…' : 'â˜†';
            const favClass = isFavorite ? 'is-favorite' : '';
            
            return `
                <li class="article-item">
                    <button class="favorite-btn ${favClass}" onclick="toggleFavorite(event, '${item.link}', ${item.isArticle})">${favIcon}</button>
                    <div class="article-title-group">
                        <a href="#" class="article-title" onclick="openPopup('${item.link}', '${item.title}'); return false;">
                            ${item.title}
                        </a>
                        <div class="article-meta">
                            <span>ì¶œì²˜: ${item.displayName}</span>
                            <span>ë¶„ë¥˜: ${item.category || '-'}</span>
                        </div>
                    </div>
                    <div class="article-date">${fullDate}</div>
                </li>
            `;
        }
        
        // -----------------------------------------------------
        // 7. ì¦ê²¨ì°¾ê¸° í† ê¸€ í•¨ìˆ˜
        // -----------------------------------------------------
        function toggleFavorite(event, link, isArticle) {
            event.stopPropagation(); // ëª©ë¡ í´ë¦­ ì´ë²¤íŠ¸ ë°©ì§€
            
            const btn = event.currentTarget;
            let isFav;

            if (isArticle) {
                isFav = favoriteArticles.has(link);
                if (isFav) {
                    favoriteArticles.delete(link);
                } else {
                    favoriteArticles.add(link);
                }
                localStorage.setItem('favoriteArticles', JSON.stringify(Array.from(favoriteArticles)));
            } else {
                isFav = favoritePublications.has(link);
                if (isFav) {
                    favoritePublications.delete(link);
                } else {
                    favoritePublications.add(link);
                }
                localStorage.setItem('favoritePublications', JSON.stringify(Array.from(favoritePublications)));
            }

            // UI ì—…ë°ì´íŠ¸
            btn.classList.toggle('is-favorite');
            btn.textContent = isFav ? 'â˜†' : 'â˜…';

            // í˜„ì¬ ë·°ê°€ ì¦ê²¨ì°¾ê¸°ì¸ ê²½ìš°, ì¦‰ì‹œ ëª©ë¡ì„ ê°±ì‹ í•˜ì—¬ ì œê±°/ì¶”ê°€ ë°˜ì˜
            if (currentView.includes('_FAV') || currentView === 'HOME') {
                 renderCurrentView();
            }
            // ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸
            if (currentView === 'HOME') {
                document.getElementById(isArticle ? 'stat-fav-articles' : 'stat-fav-publications').textContent = isArticle ? favoriteArticles.size : favoritePublications.size;
            }
        }
        
        // -----------------------------------------------------
        // 8. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // -----------------------------------------------------

        // íŒì—… í•¨ìˆ˜ (X-Frame-Options ì˜¤ë¥˜ ë°©ì§€ë¥¼ ìœ„í•´ ìƒˆ íƒ­ìœ¼ë¡œ ë„ìš°ë„ë¡ ìˆ˜ì •)
        function openPopup(link, title) {
             if (link && link !== '#') {
                 window.open(link, '_blank');
            } else {
                 alert(`"${title}"ì˜ ë§í¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.`);
            }
        }

        // ê²€ìƒ‰ ë””ë°”ìš´ìŠ¤ í•¨ìˆ˜
        function debounce(func, delay) {
            return function(...args) {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        }
        const debounceSearchArticles = debounce(renderCurrentView, 300);
        const debounceSearchPublications = debounce(renderCurrentView, 300);

        // -----------------------------------------------------
        // 9. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë° ì´ˆê¸°í™”
        // -----------------------------------------------------
        document.addEventListener('DOMContentLoaded', () => {
            // íƒ­ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì„¤ì •
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    showTab(e.target.getAttribute('data-source'));
                });
            });

            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹œì‘
            loadData();
        });

    </script>
</body>
</html>

