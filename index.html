<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ê³µì§€ëŠ¥ ë™í–¥ ë¶„ì„ ì‚¬ì´íŠ¸ | AI Trend Analyzer</title>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f4f9; }

        /* ê³ ì • í—¤ë” ìŠ¤íƒ€ì¼ */
        #header-fixed {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #471c87;
            color: white;
            text-align: center;
            padding: 15px 0;
            font-size: 1.8em;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        /* ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        .container { 
            display: flex; 
            max-width: 1400px; 
            margin: 20px auto; 
            background-color: #fff; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); 
            border-radius: 8px; 
            overflow: hidden; 
            margin-top: 80px; 
            min-height: calc(100vh - 120px); 
        }
        
        /* ì‚¬ì´ë“œë°” (ë©”ë‰´) ìŠ¤íƒ€ì¼ */
        .sidebar { 
            width: 250px; 
            background-color: #2c3e50; 
            color: white; 
            padding: 20px 0; 
            height: auto; 
            overflow-y: auto; 
            flex-shrink: 0;
        }
        .logo { text-align: center; padding-bottom: 20px; font-size: 1.5em; font-weight: bold; border-bottom: 1px solid #34495e; margin-bottom: 20px; }
        .menu-group { margin-bottom: 20px; padding: 0 20px; }
        .menu-title { font-size: 1.1em; font-weight: bold; color: #ecf0f1; margin-bottom: 10px; border-bottom: 1px solid #4a637a; padding-bottom: 5px; }
        .tab-button { display: block; padding: 10px 0; color: #bdc3c7; text-decoration: none; transition: background-color 0.3s, color 0.3s; border-radius: 4px; padding-left: 10px; }
        .tab-button:hover { background-color: #34495e; color: #fff; }
        .tab-button.active { background-color: #3498db; color: #fff; font-weight: bold; }

        /* ë©”ì¸ ì½˜í…ì¸  ìŠ¤íƒ€ì¼ */
        .content { flex-grow: 1; padding: 30px; }
        h1 { color: #2c3e50; margin-top: 0; }
        
        /* ì»¨íŠ¸ë¡¤ ì˜ì—­ (ê²€ìƒ‰, ì •ë ¬) */
        .controls-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 15px; background-color: #ecf0f1; border-radius: 6px; }
        .search-controls input, .sort-controls select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        .sort-controls label { margin-right: 10px; font-weight: bold; color: #2c3e50; }

        /* ê¸°ì‚¬ ëª©ë¡/ê°„í–‰ë¬¼ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .article-list { list-style: none; padding: 0; }
        .article-item { background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 10px; padding: 15px; display: flex; justify-content: space-between; align-items: center; transition: box-shadow 0.2s; position: relative; }
        .article-item:hover { box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .article-title-group { flex-grow: 1; margin-right: 20px; }
        .article-title { font-size: 1.1em; color: #3498db; text-decoration: none; font-weight: bold; cursor: pointer; }
        .article-meta { color: #7f8c8d; font-size: 0.9em; margin-top: 5px; }
        .article-meta span { margin-right: 15px; }
        .article-date { flex-shrink: 0; font-weight: bold; color: #2c3e50; font-size: 1em; }
        
        /* ì¦ê²¨ì°¾ê¸° ë²„íŠ¼ */
        .favorite-btn { background: none; border: none; font-size: 1.5em; cursor: pointer; padding: 0 5px; color: #ccc; transition: color 0.2s; }
        .favorite-btn.is-favorite { color: #f39c12; }
        .favorite-btn:hover { color: #e67e22; }

        /* ë°ì´í„° ì—†ìŒ ë©”ì‹œì§€ */
        #no-data { text-align: center; color: #e74c3c; padding: 40px; border: 1px dashed #e74c3c; border-radius: 6px; margin-top: 20px; display: none; }
        
        /* ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ */
        #dashboard-view { padding: 20px; background-color: #ecf0f1; border-radius: 8px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background-color: #fff; padding: 20px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center; }
        .stat-card h3 { color: #34495e; margin-top: 0; font-size: 1.1em; }
        .stat-card p { font-size: 2.5em; font-weight: bold; color: #3498db; margin: 5px 0 0 0; }
        .trend-section h2 { border-bottom: 2px solid #bdc3c7; padding-bottom: 10px; color: #2c3e50; }
        .latest-list { list-style: none; padding: 0; }
        .latest-item { background-color: #f9f9f9; padding: 10px; margin-bottom: 8px; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; }
        .latest-item a { color: #2c3e50; text-decoration: none; font-weight: bold; }
        .latest-item a:hover { text-decoration: underline; }
        .latest-item span { font-size: 0.9em; color: #7f8c8d; }

        /* ì¹´í”¼ë¼ì´íŠ¸ ìŠ¤íƒ€ì¼ */
        #footer-copyright {
            text-align: center;
            padding: 15px 0;
            font-size: 0.9em;
            color: #7f8c8d;
            background-color: #ecf0f1;
            margin-top: 20px;
        }

        /* ------------------------------------------------ */
        /* ì¹´í…Œê³ ë¦¬ ë±ƒì§€ ìŠ¤íƒ€ì¼ */
        /* ------------------------------------------------ */
        .category-badge {
            font-size: 0.75em;
            padding: 2px 6px;
            border-radius: 4px;
            color: white;
            margin-left: 8px;
            vertical-align: middle;
            font-weight: normal;
            display: inline-block;
        }
        /* êµ­ë°©: íŒŒë€ìƒ‰ */
        .cat-defense { background-color: #3498db; }
        /* ìœ¡êµ°: ì´ˆë¡ìƒ‰ */
        .cat-army { background-color: #2ea44f; }
        /* ë¯¼ê°„: ë¹¨ê°„ìƒ‰ */
        .cat-civil { background-color: #e74c3c; }
        /* ê¸°íƒ€: ë…¸ë€ìƒ‰ (ê¸€ììƒ‰ ê²€ì •) */
        .cat-etc { background-color: #f1c40f; color: #333; }
        
        /* [ìƒˆë¡œ ì¶”ê°€] ê°„í–‰ë¬¼: ì£¼í™©ìƒ‰ ë°°ê²½, í°ìƒ‰ ê¸€ì */
        .cat-pub { background-color: #ff9800; color: white; }
        
        /* ê¸°ë³¸ê°’ */
        .cat-default { background-color: #758888; }

    </style>
</head>
<body>
    <div id="header-fixed">
        ìœ¡êµ°ë³¸ë¶€ ì¸ê³µì§€ëŠ¥ ì¼ì¼ë™í–¥ ë¶„ì„
    </div>
    <div class="container">
        <div class="sidebar">

            <div class="logo">AI ë™í–¥ë¶„ì„
            <button id="runActionBtn" style="
                padding: 2px 7px;
                background-color: #2ea44f; 
                color: white; 
                border: none; 
                border-radius: 6px; 
                font-weight: bold; 
                cursor: pointer;">
                ì—…ë°ì´íŠ¸
            </button>
            </div>
            <nav id="main-nav">
                <div class="menu-group">
                    <a href="#" class="tab-button active" data-source="HOME">ğŸ  ëŒ€ì‹œë³´ë“œ</a>

                </div>
                <div class="menu-group">
                    <div class="menu-title">ê¸°ì‚¬ (NEWS)</div>
                    <a href="#" class="tab-button" data-source="ARTICLE_ALL">ğŸ“° ì „ì²´ë³´ê¸°</a>
                    <div style="display: flex; align-items: center; padding-right: 10px;">
                        <a href="#" class="tab-button" data-source="ARTICLE_FAV" style="flex-grow: 1;">â­ï¸ ì¦ê²¨ì°¾ê¸°</a>
                        <button onclick="clearFavorites('ARTICLE')" style="background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; padding: 2px 6px; font-size: 0.75em; height: 24px;">ì´ˆê¸°í™”</button>
                    </div>
                    <a href="#" class="tab-button" data-source="AITIMES">AI Times</a>
                    <a href="#" class="tab-button" data-source="ETNEWS">ì „ìì‹ ë¬¸</a>
                    <a href="#" class="tab-button" data-source="MND">êµ­ë°©ë‰´ìŠ¤</a>
                </div>
                <div class="menu-group">
                    <div class="menu-title">ê°„í–‰ë¬¼ (PUBLICATION)</div>
                    <a href="#" class="tab-button" data-source="PUBLICATION_ALL">ğŸ“š ì „ì²´ë³´ê¸°</a>
                    <div style="display: flex; align-items: center; padding-right: 10px;">
                        <a href="#" class="tab-button" data-source="PUBLICATION_FAV" style="flex-grow: 1;">â­ï¸ ì¦ê²¨ì°¾ê¸°</a>
                        <button onclick="clearFavorites('PUBLICATION')" style="background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; padding: 2px 6px; font-size: 0.75em; height: 24px;">ì´ˆê¸°í™”</button>
                    </div>
                    <a href="#" class="tab-button" data-source="NIA">NIA</a>
                    <a href="#" class="tab-button" data-source="IITP">IITP</a>
                    <a href="#" class="tab-button" data-source="STEPI">STEPI</a>
                    <a href="#" class="tab-button" data-source="NIPA">NIPA</a>
                </div>
            </nav>
        </div>

        <div class="content">
            <h1 id="main-content-title">í™ˆ (ëŒ€ì‹œë³´ë“œ)</h1>

            <div id="dashboard-view">
                <h2>ğŸ“Š ìš”ì•½ ì •ë³´</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>ì´ ê¸°ì‚¬ ìˆ˜</h3>
                        <p id="stat-articles">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>ì´ ê°„í–‰ë¬¼ ìˆ˜</h3>
                        <p id="stat-publications">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>ì¦ê²¨ì°¾ëŠ” ê¸°ì‚¬ ìˆ˜</h3>
                        <p id="stat-fav-articles">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>ì¦ê²¨ì°¾ëŠ” ê°„í–‰ë¬¼ ìˆ˜</h3>
                        <p id="stat-fav-publications">0</p>
                    </div>
                </div>

                <div class="trend-section">
                    <h2>âœ¨ ìµœì‹  ê¸°ì‚¬ 5ê°œ</h2>
                    <ul class="latest-list" id="latest-articles">
                        </ul>
                </div>

                <div class="trend-section">
                    <h2>âœ¨ ìµœì‹  ê°„í–‰ë¬¼ 5ê°œ</h2>
                    <ul class="latest-list" id="latest-publications">
                        </ul>
                </div>
            </div>

            <div class="controls-row" id="article-controls" style="display: none;">
                <div class="search-controls">
                    <input type="text" id="search-term-article" placeholder="ê¸°ì‚¬ ê²€ìƒ‰ (ì œëª©, ì‚¬ì´íŠ¸)" onkeyup="debounceSearchArticles()">
                </div>
                <div class="sort-controls">
                    <label for="sort-by-article">ì •ë ¬ ê¸°ì¤€:</label>
                    <select id="sort-by-article" onchange="renderCurrentView()">
                        <option value="date_desc">ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ìˆœ)</option>
                        <option value="date_asc">ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ (ì˜¤ë˜ëœìˆœ)</option>
                        <option value="title_asc">ì œëª© ì˜¤ë¦„ì°¨ìˆœ</option>
                        <option value="site_asc">ì‚¬ì´íŠ¸ ì˜¤ë¦„ì°¨ìˆœ</option>
                    </select>
                </div>
            </div>

            <div class="controls-row" id="publication-controls" style="display: none;">
                <div class="search-controls">
                    <input type="text" id="search-term-publication" placeholder="ê°„í–‰ë¬¼ ê²€ìƒ‰ (ì œëª©, ë¶„ë¥˜)" onkeyup="debounceSearchPublications()">
                </div>
                <div class="sort-controls">
                    <label for="sort-by-publication">ì •ë ¬ ê¸°ì¤€:</label>
                    <select id="sort-by-publication" onchange="renderCurrentView()">
                        <option value="date_desc">ë‚ ì§œ ë‚´ë¦¼ì°¨ìˆœ (ìµœì‹ ìˆœ)</option>
                        <option value="date_asc">ë‚ ì§œ ì˜¤ë¦„ì°¨ìˆœ (ì˜¤ë˜ëœìˆœ)</option>
                        <option value="title_asc">ì œëª© ì˜¤ë¦„ì°¨ìˆœ</option>
                        <option value="category_asc">ë¶„ë¥˜ ì˜¤ë¦„ì°¨ìˆœ</option>
                    </select>
                </div>
            </div>
            
            <div id="list-view" style="display: none;">
                <ul class="article-list" id="data-list-container">
                    </ul>
                <div id="no-data">ë°ì´í„° ë¡œë“œ ì¤‘...</div>
            </div>
            
        </div>
    </div>
    
    <div id="footer-copyright">
        &copy; maj.cjh. All rights reserved.
    </div>

    <script>
    document.getElementById('runActionBtn').addEventListener('click', async function() {
    const token = "github_pat_11B3KXJKY0SHfTVuXaRCJS_iXJF2Zj23h2xFEh8N9EKAejuLUYrJFdkNzWFYmhhdZaJDEN2FKRUAue" + prompt("âš ï¸ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.\nì…ë ¥í•œ ì½”ë“œëŠ” ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
    if (!token) {
        alert("í† í°ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        return;
    }
    const OWNER = "jhjhc1483";
    const REPO = "AI_Trend_Analysis";
    const WORKFLOW_ID = "main.yml";
    const url = `https://api.github.com/repos/${OWNER}/${REPO}/actions/workflows/${WORKFLOW_ID}/dispatches`;
    try {
        const response = await fetch(url, {
            method: 'POST',
            headers: {
                "Authorization": `token ${token}`,
                "Accept": "application/vnd.github.v3+json",
            },
            body: JSON.stringify({ ref: "main" })
        });
        if (response.status === 204) {
            alert("âœ… ì‹¤í–‰ ì„±ê³µ! ìµœëŒ€ 5ë¶„ì˜ ì‹œê°„ì´ ì†Œìš” ë©ë‹ˆë‹¤.\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•˜ì„¸ìš”.");
        } else if (response.status === 401) {
            alert("âŒ ì‹¤íŒ¨: í† í°ì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (401 Unauthorized)");
        } else if (response.status === 404) {
            alert("âŒ ì‹¤íŒ¨: ì €ì¥ì†Œë‚˜ ì›Œí¬í”Œë¡œìš°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (404 Not Found)");
        } else {
            const errorData = await response.json();
            alert(`âŒ ì‹¤íŒ¨: ${response.status}\në©”ì‹œì§€: ${errorData.message}`);
        }
    } catch (error) {
        console.error('Error:', error);
        alert("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
});

        // -----------------------------------------------------
        // 1. ì „ì—­ ë³€ìˆ˜ ì„¤ì • ë° ë°ì´í„° ë¡œë“œ íŒŒì¼ ì •ì˜
        // -----------------------------------------------------
        let articleData = []; // ê¸°ì‚¬ ë°ì´í„° (AI Times, ETNEWS, MND)
        let publicationData = []; // ê°„í–‰ë¬¼ ë°ì´í„° (NIA, IITP)
        let allDataLoaded;
        let debounceTimeout;
        let currentView = 'HOME'; // í˜„ì¬ í™œì„±í™”ëœ ë·°

        // ì¦ê²¨ì°¾ê¸° ìƒíƒœ ì €ì¥ ë³€ìˆ˜ (ë‘˜ ë‹¤ Mapìœ¼ë¡œ ê´€ë¦¬)
        let favoriteArticles = new Map(); // Link -> Category
        // [ë³€ê²½] ê°„í–‰ë¬¼ë„ Mapìœ¼ë¡œ ë³€ê²½í•˜ì—¬ 'ê°„í–‰ë¬¼' ì¹´í…Œê³ ë¦¬ ì €ì¥
        let favoritePublications = new Map(); // Link -> Category ('ê°„í–‰ë¬¼')
        
        const FILES_TO_LOAD = [
            { url: 'codes/aitimes.json', site: 'AITIMES', isArticle: true, displayName: 'AI Times' },
            { url: 'codes/etnews.json', site: 'ETNEWS', isArticle: true, displayName: 'ì „ìì‹ ë¬¸' },
            { url: 'codes/mnd.json', site: 'MND', isArticle: true, displayName: 'êµ­ë°©ë‰´ìŠ¤' },
            { url: 'codes/iitp.json', site: 'IITP', isArticle: false, displayName: 'IITP' },
            { url: 'codes/nia.json', site: 'NIA', isArticle: false, displayName: 'NIA' },
            { url: 'codes/STEPI.json', site: 'STEPI', isArticle: false, displayName: 'STEPI' },
            { url: 'codes/NIPA.json', site: 'NIPA', isArticle: false, displayName: 'NIPA' }
        ];

        // -----------------------------------------------------
        // 2. ë°ì´í„° ë¡œë”© í•¨ìˆ˜
        // -----------------------------------------------------
        function loadData() {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì¦ê²¨ì°¾ê¸° ë¡œë“œ
            const favArticlesStr = localStorage.getItem('favoriteArticles');
            const favPublicationsStr = localStorage.getItem('favoritePublications');
            
            // ê¸°ì‚¬ ì¦ê²¨ì°¾ê¸° ë¡œë“œ
            if (favArticlesStr) {
                const parsed = JSON.parse(favArticlesStr);
                if (Array.isArray(parsed) && parsed.length > 0 && Array.isArray(parsed[0])) {
                    favoriteArticles = new Map(parsed);
                } else if (Array.isArray(parsed)) {
                    favoriteArticles = new Map(parsed.map(link => [link, 'ê¸°íƒ€']));
                }
            }

            // [ë³€ê²½] ê°„í–‰ë¬¼ ì¦ê²¨ì°¾ê¸° ë¡œë“œ (Set -> Map í˜¸í™˜ì„± ì²˜ë¦¬)
            if (favPublicationsStr) {
                const parsed = JSON.parse(favPublicationsStr);
                if (Array.isArray(parsed) && parsed.length > 0 && Array.isArray(parsed[0])) {
                    // ì‹ ê·œ ë°©ì‹ (Map ì €ì¥ë³¸)
                    favoritePublications = new Map(parsed);
                } else if (Array.isArray(parsed)) {
                    // êµ¬ ë°©ì‹ (ë°°ì—´) -> ëª¨ë‘ 'ê°„í–‰ë¬¼' ì¹´í…Œê³ ë¦¬ë¡œ ë³€í™˜
                    favoritePublications = new Map(parsed.map(link => [link, 'ê°„í–‰ë¬¼']));
                }
            }

            const promises = FILES_TO_LOAD.map(file => {
                return fetch(file.url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Failed to load ${file.url}: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        return data.map(item => ({
                            ...item,
                            site: file.site,
                            isArticle: file.isArticle,
                            displayName: file.displayName,
                            title: item.ê¸°ì‚¬ëª… || item.ì œëª© || 'ì œëª© ì—†ìŒ',
                            link: item.ë§í¬ || item.link || '#',
                            category: item.ë¶„ë¥˜ || item.category || '',
                        }));
                    })
                    .catch(error => {
                        console.error(`Error loading ${file.url}:`, error);
                        return [];
                    });
            });

            Promise.all(promises)
                .then(results => {
                    results.forEach(siteData => {
                        if (siteData.length > 0) {
                            if (siteData[0].isArticle) {
                                articleData = articleData.concat(siteData);
                            } else {
                                publicationData = publicationData.concat(siteData);
                            }
                        }
                    });

                    allDataLoaded = true;
                    console.log(`ì´ ${articleData.length}ê°œì˜ ê¸°ì‚¬ ë°ì´í„°ì™€ ${publicationData.length}ê°œì˜ ê°„í–‰ë¬¼ ë°ì´í„° ë¡œë“œ ì™„ë£Œ.`);
                    
                    showTab('HOME');
                })
                .catch(error => {
                    console.error("Critical error in Promise.all:", error);
                    document.getElementById('no-data').textContent = "ë°ì´í„° ë¡œë“œ ì¤‘ ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ ë°œìƒ.";
                });
        }

        // -----------------------------------------------------
        // 3. ì •ë ¬ í•¨ìˆ˜
        // -----------------------------------------------------
        function sortData(data, sortBy) {
            const sortedData = [...data];

            sortedData.sort((a, b) => {
                const getDateString = (item) => `${item.ë…„ || '0000'}${item.ì›” || '00'}${item.ì¼ || '00'}${item.ì‹œ || '00'}${item.ë¶„ || '00'}`;
                const dateA = getDateString(a);
                const dateB = getDateString(b);
                const titleA = a.title;
                const titleB = b.title;
                const siteA = a.site;
                const siteB = b.site;
                const categoryA = a.category;
                const categoryB = b.category;

                switch (sortBy) {
                    case 'date_asc': return dateA.localeCompare(dateB);
                    case 'date_desc': return dateB.localeCompare(dateA);
                    case 'title_asc': return titleA.localeCompare(titleB);
                    case 'site_asc': 
                        if (siteA !== siteB) return siteA.localeCompare(siteB);
                        return dateB.localeCompare(dateA);
                    case 'category_asc': 
                        if (categoryA !== categoryB) return categoryA.localeCompare(categoryB);
                        return dateB.localeCompare(dateA);
                    default: return 0;
                }
            });
            return sortedData;
        }


        // -----------------------------------------------------
        // 4. íƒ­ ì „í™˜ ë° ë Œë”ë§ í•¨ìˆ˜
        // -----------------------------------------------------
        function showTab(sourceName) {
            currentView = sourceName;
            
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            const activeTab = document.querySelector(`.tab-button[data-source="${sourceName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }

            const isHome = sourceName === 'HOME';
            const isArticleView = sourceName.includes('ARTICLE') || ['AITIMES', 'ETNEWS', 'MND'].includes(sourceName);
            const isPublicationView = sourceName.includes('PUBLICATION') || ['NIA', 'IITP','STEPI', 'NIPA'].includes(sourceName);

            document.getElementById('dashboard-view').style.display = isHome ? 'block' : 'none';
            document.getElementById('list-view').style.display = isHome ? 'none' : 'block';

            document.getElementById('article-controls').style.display = isArticleView ? 'flex' : 'none';
            document.getElementById('publication-controls').style.display = isPublicationView ? 'flex' : 'none';
            
            document.getElementById('main-content-title').textContent = activeTab ? activeTab.textContent.replace(/^(ğŸ |ğŸ“°|â­ï¸|ğŸ“š) /, '') : 'AI ë™í–¥ ë¶„ì„';

            if (isHome) {
                renderDashboard();
            } else {
                renderList(sourceName);
            }
        }
        
        function renderCurrentView() {
            showTab(currentView);
        }

        // -----------------------------------------------------
        // 5. ëŒ€ì‹œë³´ë“œ ë Œë”ë§ í•¨ìˆ˜
        // -----------------------------------------------------
        function renderDashboard() {
            // í†µê³„ ì—…ë°ì´íŠ¸
            document.getElementById('stat-articles').textContent = articleData.length;
            document.getElementById('stat-publications').textContent = publicationData.length;
            document.getElementById('stat-fav-articles').textContent = favoriteArticles.size;
            document.getElementById('stat-fav-publications').textContent = favoritePublications.size;

            // ìµœì‹  ê¸°ì‚¬ 5ê°œ
            const sortedArticles = sortData(articleData, 'date_desc');
            const latestArticles = sortedArticles.slice(0, 5);
            document.getElementById('latest-articles').innerHTML = latestArticles.map(item => `
                <li class="latest-item">
                    <a href="#" onclick="openPopup('${item.link}', '${item.title}'); return false;">${item.title}</a>
                    <span>${item.displayName} | ${item.ë…„}.${item.ì›”}.${item.ì¼}</span>
                </li>
            `).join('');

            // ìµœì‹  ê°„í–‰ë¬¼ 5ê°œ
            const sortedPublications = sortData(publicationData, 'date_desc');
            const latestPublications = sortedPublications.slice(0, 5);
            document.getElementById('latest-publications').innerHTML = latestPublications.map(item => `
                <li class="latest-item">
                    <a href="#" onclick="openPopup('${item.link}', '${item.title}'); return false;">${item.title}</a>
                    <span>${item.displayName} | ${item.ë…„}.${item.ì›”}.${item.ì¼}</span>
                </li>
            `).join('');
        }

        // -----------------------------------------------------
        // 6. ëª©ë¡ ë Œë”ë§ í•¨ìˆ˜ (ê¸°ì‚¬ ë° ê°„í–‰ë¬¼ ê³µí†µ)
        // -----------------------------------------------------
        function renderList(sourceName) {
            let data = [];
            let sortBy, searchTerm, dataLabel;

            const isArticle = sourceName.includes('ARTICLE') || ['AITIMES', 'ETNEWS', 'MND'].includes(sourceName);
            const isAll = sourceName.includes('_ALL');
            const isFav = sourceName.includes('_FAV');
            
            if (isArticle) {
                sortBy = document.getElementById('sort-by-article').value;
                searchTerm = document.getElementById('search-term-article').value.toLowerCase();
                dataLabel = 'ê¸°ì‚¬';
                
                if (isFav) {
                    data = articleData.filter(a => favoriteArticles.has(a.link));
                } else if (isAll) {
                    data = articleData;
                } else {
                    data = articleData.filter(a => a.site === sourceName);
                }
            } else { // Publication
                sortBy = document.getElementById('sort-by-publication').value;
                searchTerm = document.getElementById('search-term-publication').value.toLowerCase();
                dataLabel = 'ê°„í–‰ë¬¼';

                if (isFav) {
                    data = publicationData.filter(p => favoritePublications.has(p.link));
                } else if (isAll) {
                    data = publicationData;
                } else {
                    data = publicationData.filter(p => p.site === sourceName);
                }
            }

            if (searchTerm) {
                data = data.filter(item => item.title.toLowerCase().includes(searchTerm));
            }

            const filteredAndSortedData = sortData(data, sortBy);
            const listContainer = document.getElementById('data-list-container');
            const noDataMsg = document.getElementById('no-data');

            if (filteredAndSortedData.length === 0) {
                listContainer.innerHTML = '';
                noDataMsg.style.display = 'block';
                noDataMsg.textContent = searchTerm 
                    ? `ê²€ìƒ‰ì–´ "${searchTerm}"ì— í•´ë‹¹í•˜ëŠ” ${dataLabel}ê°€(ì´) ì—†ìŠµë‹ˆë‹¤.` 
                    : `${document.querySelector(`.tab-button[data-source="${sourceName}"]`).textContent.replace(/^(ğŸ“°|â­ï¸|ğŸ“š) /, '')} ${dataLabel} ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`;
            } else {
                listContainer.innerHTML = filteredAndSortedData.map(item => createListItem(item)).join('');
                noDataMsg.style.display = 'none';
            }
        }
        
        function createListItem(item) {
            const timeInfo = (item.ì‹œ && item.ë¶„) 
                ? `${item.ì‹œ.padStart(2, '0')}:${item.ë¶„.padStart(2, '0')}` 
                : '';
            const fullDate = `${item.ë…„}.${item.ì›”}.${item.ì¼} ${timeInfo}`;

            // ì¦ê²¨ì°¾ê¸° ì—¬ë¶€ í™•ì¸
            let isFavorite = false;
            let categoryBadge = '';
            
            // ê¸°ì‚¬ì™€ ê°„í–‰ë¬¼ ëª¨ë‘ Mapì—ì„œ í™•ì¸
            if (item.isArticle) {
                isFavorite = favoriteArticles.has(item.link);
            } else {
                isFavorite = favoritePublications.has(item.link);
            }

            // ì¦ê²¨ì°¾ê¸° ìƒíƒœë¼ë©´ ì¹´í…Œê³ ë¦¬ ë±ƒì§€ ìƒì„±
            if (isFavorite) {
                const savedCat = item.isArticle 
                    ? favoriteArticles.get(item.link) 
                    : favoritePublications.get(item.link); // ê°„í–‰ë¬¼ì€ 'ê°„í–‰ë¬¼' ë°˜í™˜
                
                let colorClass = 'cat-etc'; 

                if (savedCat === 'êµ­ë°©') colorClass = 'cat-defense';
                else if (savedCat === 'ìœ¡êµ°') colorClass = 'cat-army';
                else if (savedCat === 'ë¯¼ê°„') colorClass = 'cat-civil';
                else if (savedCat === 'ê°„í–‰ë¬¼') colorClass = 'cat-pub'; // [ì¶”ê°€] ê°„í–‰ë¬¼ í´ë˜ìŠ¤ ì ìš©
                else if (savedCat === 'ê¸°íƒ€') colorClass = 'cat-etc';
                else colorClass = 'cat-default'; 

                categoryBadge = `<span class="category-badge ${colorClass}">${savedCat}</span>`;
            }

            const favIcon = isFavorite ? 'â˜…' : 'â˜†';
            const favClass = isFavorite ? 'is-favorite' : '';
            
            return `
                <li class="article-item">
                    <button class="favorite-btn ${favClass}" onclick="toggleFavorite(event, '${item.link}', ${item.isArticle})">${favIcon}</button>
                    <div class="article-title-group">
                        <a href="#" class="article-title" onclick="openPopup('${item.link}', '${item.title}'); return false;">
                            ${item.title}
                        </a>
                        ${categoryBadge}
                        <div class="article-meta">
                            <span>ì¶œì²˜: ${item.displayName}</span>
                            <span>ë¶„ë¥˜: ${item.category || '-'}</span>
                        </div>
                    </div>
                    <div class="article-date">${fullDate}</div>
                </li>
            `;
        }
        
        // -----------------------------------------------------
        // 7. ì¦ê²¨ì°¾ê¸° í† ê¸€ í•¨ìˆ˜
        // -----------------------------------------------------
        function toggleFavorite(event, link, isArticle) {
            event.stopPropagation();
            let isFav;

            if (isArticle) {
                isFav = favoriteArticles.has(link);
                if (isFav) {
                    favoriteArticles.delete(link);
                } else {
                    let categoryInput = prompt("ì¹´í…Œê³ ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš” (êµ­ë°©, ìœ¡êµ°, ë¯¼ê°„, ê¸°íƒ€)", "ê¸°íƒ€");
                    if (categoryInput === null) return;
                    categoryInput = categoryInput.trim();
                    if (categoryInput === "") categoryInput = "ê¸°íƒ€";
                    favoriteArticles.set(link, categoryInput);
                }
                localStorage.setItem('favoriteArticles', JSON.stringify(Array.from(favoriteArticles.entries())));
            } else {
                // [ë³€ê²½] ê°„í–‰ë¬¼ ì²˜ë¦¬: Prompt ì—†ì´ 'ê°„í–‰ë¬¼'ë¡œ ìë™ ì €ì¥
                isFav = favoritePublications.has(link);
                if (isFav) {
                    favoritePublications.delete(link);
                } else {
                    // ì‚¬ìš©ì ì…ë ¥ ì—†ì´ 'ê°„í–‰ë¬¼' ì¹´í…Œê³ ë¦¬ ì§€ì •
                    favoritePublications.set(link, 'ê°„í–‰ë¬¼');
                }
                localStorage.setItem('favoritePublications', JSON.stringify(Array.from(favoritePublications.entries())));
            }

            // UI ì—…ë°ì´íŠ¸
            renderCurrentView();

            if (currentView === 'HOME') {
                document.getElementById(isArticle ? 'stat-fav-articles' : 'stat-fav-publications').textContent = isArticle ? favoriteArticles.size : favoritePublications.size;
            }
        }

        function clearFavorites(type) {
            if (!confirm(`${type === 'ARTICLE' ? 'ê¸°ì‚¬' : 'ê°„í–‰ë¬¼'} ì¦ê²¨ì°¾ê¸°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            if (type === 'ARTICLE') {
                favoriteArticles.clear();
                localStorage.setItem('favoriteArticles', JSON.stringify([]));
            } else {
                favoritePublications.clear();
                localStorage.setItem('favoritePublications', JSON.stringify([]));
            }
            renderCurrentView();
        }   

        // -----------------------------------------------------
        // 8. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // -----------------------------------------------------
        function openPopup(link, title) {
             if (link && link !== '#') {
                 window.open(link, '_blank');
            } else {
                 alert(`"${title}"ì˜ ë§í¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.`);
            }
        }

        function debounce(func, delay) {
            return function(...args) {
                clearTimeout(debounceTimeout);
                debounceTimeout = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        }
        const debounceSearchArticles = debounce(renderCurrentView, 300);
        const debounceSearchPublications = debounce(renderCurrentView, 300);

        // -----------------------------------------------------
        // 9. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë° ì´ˆê¸°í™”
        // -----------------------------------------------------
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    showTab(e.target.getAttribute('data-source'));
                });
            });

            loadData();
        });

    </script>
</body>
</html>
